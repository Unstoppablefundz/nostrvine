---
title: "9:25:47 PM - October 17, 2025"
date: 2025-10-17T08:25:47.974Z
timestamp: 1760689547974
---

## Project Notes

**Replaceable Events Implementation (NIP-33) - VideoEventService:**

Successfully implemented timestamp-based replaceable event handling for video events (kinds 34235, 34236):

1. **Core Logic (`_handleReplaceableVideoEvent`):**
   - Tracks events by `(subscriptionType, kind, pubkey, d-tag)` tuple
   - Compares timestamps when duplicate replaceable event arrives
   - Keeps newer version, removes old from `_eventLists`
   - Returns false to skip older incoming events

2. **Integration Points:**
   - Called in both `_handleNewVideoEvent` (real-time) and `_handleHistoricalVideoEvent` (pagination)
   - Works across all subscription types (discovery, homeFeed, profile, etc.)

3. **Test Infrastructure:**
   - Added `handleEventForTesting()` method with `@visibleForTesting` annotation
   - Created comprehensive test file covering:
     - Newer replaces older
     - Older rejected when newer exists
     - Different d-tags create separate videos
     - Subscription-type isolation
     - Non-replaceable events (kind 22) not deduplicated

4. **Status:**
   - Implementation complete and committed (d425502)
   - Test file needs Event constructor fixes (nostr_sdk Event takes positional args)
   - Next: Complete test fixes, verify tests pass, then apply same pattern to other cache services

**Key Insight:** This same pattern will need to be applied to:
- ProfileCacheService (kind 0 profile events)
- Any other cache services handling replaceable events
